#! /usr/bin/env ruby
require "rubygems"
require "bundler/setup"

require_relative "../lib/newrelic_unicorn_plugin"

module UnicornAgent

  class Agent < NewRelic::Plugin::Agent::Base

    agent_guid 'tk.dmap.newrelic.unicorn'
    agent_version '1.0.0'
    agent_config_options :application_name
    agent_human_labels("Unicorn Agent") { application_name }

    def poll_cycle
      x = Time.now.to_f * Math::PI * 2
      report_metric "SIN",     "Value", Math.sin(x) + 1.0
      report_metric "COS",     "Value", Math.cos(x) + 1.0
      report_metric "BIASSIN", "Value", Math.sin(x) + 5.0
    end

  end

  #
  # Register this agent with the component.
  # The ExampleAgent is the name of the module that defines this
  # driver (the module must contain at least three classes - a
  # PollCycle, a Metric and an Agent class, as defined above).
  #
  NewRelic::Plugin::Setup.install_agent :unicorn, UnicornAgent

  #
  # Launch the agent; this never returns.
  #
  NewRelic::Plugin::Run.setup_and_run

end
